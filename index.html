<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <!-- é€™è¡Œæ˜¯éŸ¿æ‡‰å¼è¨­è¨ˆçš„é—œéµï¼Œç¢ºä¿ç¶²é å¯¬åº¦ç­‰æ–¼è£ç½®å¯¬åº¦ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oral Practice Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
        }
        .group-btn {
            transition: all 0.2s ease-in-out;
        }
        .group-btn.active {
            background-color: #10B981; /* emerald-500 */
            color: white;
            font-weight: bold;
            transform: scale(1.05);
        }
        .star-rating .star {
            color: #d1d5db; /* gray-400 */
            font-size: 2rem;
            transition: color 0.2s;
        }
        @media (min-width: 640px) {
            .star-rating .star {
                font-size: 2.5rem;
            }
        }
        .star-rating .star.filled {
            color: #f59e0b; /* amber-500 */
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

    <div class="w-full max-w-4xl bg-white shadow-lg flex flex-col flex-grow sm:rounded-2xl sm:mx-auto sm:my-4">
        <header class="bg-emerald-500 p-4 sm:p-6 text-center rounded-t-2xl">
            <h1 class="text-2xl sm:text-3xl font-bold text-white tracking-wider">Oral Practice Assistant</h1>
            <p class="text-emerald-100 mt-1 text-sm sm:text-base">Your best AI partner for English learning!</p>
        </header>

        <main class="p-4 sm:p-6 lg:p-8 relative flex-grow overflow-y-auto">
            <!-- Student Info Area -->
            <div id="user-info-area" class="space-y-6">
                <div class="text-center">
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800">é–‹å§‹ç·´ç¿’å‰</h2>
                    <p class="text-gray-500 mt-1">è«‹è¼¸å…¥ä½ çš„ç­ç´šå’Œå§“å</p>
                </div>
                <div class="max-w-sm mx-auto space-y-4">
                    <div>
                        <label for="student-class-input" class="block text-sm font-medium text-gray-700">ç­ç´š</label>
                        <input type="text" id="student-class-input" class="mt-1 w-full p-3 border-2 border-gray-300 rounded-lg text-base sm:text-lg focus:ring-2 focus:ring-emerald-400 focus:border-emerald-400" placeholder="ä¾‹å¦‚ï¼šä¸‰å¹´äºŒç­">
                    </div>
                    <div>
                        <label for="student-name-input" class="block text-sm font-medium text-gray-700">å§“å</label>
                        <input type="text" id="student-name-input" class="mt-1 w-full p-3 border-2 border-gray-300 rounded-lg text-base sm:text-lg focus:ring-2 focus:ring-emerald-400 focus:border-emerald-400" placeholder="ä¾‹å¦‚ï¼šç‹å°æ˜">
                    </div>
                    <button onclick="startPractice()" class="w-full bg-emerald-500 text-white font-bold py-3 px-6 rounded-lg text-base sm:text-lg hover:bg-emerald-600 transition-colors">é–‹å§‹ç·´ç¿’</button>
                </div>
            </div>

            <!-- Main Practice Area -->
            <div id="main-practice-container" class="hidden space-y-6">
                <div class="text-center">
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800">ä¸­æ–‡èªªè‹±æ–‡</h2>
                    <p class="text-gray-500 mt-1">é¸æ“‡ä¸€å€‹ç¾¤çµ„ï¼Œé–‹å§‹ä½ çš„è‹±æ–‡å­¸ç¿’ä¹‹æ—…ï¼</p>
                </div>
                
                <!-- Group Selection -->
                <div class="border-t border-b py-4">
                    <h3 class="text-lg font-semibold text-center text-gray-700 mb-3">é¸æ“‡ç·´ç¿’ç¾¤çµ„</h3>
                    <div id="t1-group-selection" class="flex flex-wrap justify-center gap-2">
                        <!-- Group buttons will be generated here -->
                    </div>
                </div>

                <div id="t1-practice-area" class="hidden space-y-4">
                    <div class="flex-grow relative">
                        <input type="text" id="t1-input" class="w-full p-3 pr-10 border-2 border-gray-300 rounded-lg text-base sm:text-lg focus:ring-2 focus:ring-emerald-400 focus:border-emerald-400" placeholder="è¼¸å…¥ä¸­æ–‡ï¼Œæˆ–æŒ‰ã€Œéš¨æ©Ÿè©å½™ã€">
                        <button id="t1-mic-btn" onclick="startChineseRecognition()" class="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-500 hover:text-emerald-500" title="ç”¨èªªçš„è¼¸å…¥ä¸­æ–‡">
                            <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                              <path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm5 8.25V15a.75.75 0 01-1.5 0v-2.75A4.5 4.5 0 005.5 8V4a.5.5 0 011 0v4a3.5 3.5 0 007 0V4a.5.5 0 011 0v4a4.5 4.5 0 01-4.5 4.25z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                    <div class="flex flex-col sm:flex-row justify-center gap-3 sm:gap-4">
                        <button onclick="getNextWord()" class="bg-teal-500 text-white font-bold py-3 px-6 rounded-lg text-base sm:text-lg hover:bg-teal-600 transition-colors">éš¨æ©Ÿè©å½™</button>
                        <button onclick="translateAndSpeak()" class="bg-emerald-500 text-white font-bold py-3 px-6 rounded-lg text-base sm:text-lg hover:bg-emerald-600 transition-colors">ç¿»è­¯ä¸¦æœ—è®€</button>
                    </div>
                </div>

                <div id="t1-result-area" class="hidden text-center p-4 sm:p-6 bg-emerald-50 rounded-lg space-y-4">
                    <div>
                        <p class="text-gray-500">ä¸­æ–‡åŸæ–‡</p>
                        <p id="t1-chinese-output" class="text-xl sm:text-2xl font-semibold text-gray-700"></p>
                    </div>
                    <div>
                        <p class="text-emerald-600">è‹±æ–‡ç¿»è­¯</p>
                        <p id="t1-english-output" class="text-2xl sm:text-3xl font-bold text-emerald-700"></p>
                    </div>
                    <div class="flex flex-col sm:flex-row flex-wrap justify-center gap-3 sm:gap-4">
                        <button onclick="repeatAudio('t1-english-output')" class="bg-sky-500 text-white font-bold py-3 px-6 rounded-lg text-base sm:text-lg hover:bg-sky-600 transition-colors">
                            <span class="mr-2">ğŸ”Š</span>å†èªªä¸€æ¬¡
                        </button>
                        <button id="t1-record-btn" onmousedown="startEnglishRecognition()" onmouseup="stopRecognition()" ontouchstart="startEnglishRecognition()" ontouchend="stopRecognition()" class="bg-amber-500 text-white font-bold py-3 px-6 rounded-lg text-base sm:text-lg hover:bg-amber-600 active:bg-red-600 transition-colors select-none">
                            <span class="mr-2">ğŸ¤</span>æŒ‰ä½èªªè©±
                        </button>
                        <button onclick="getNextWord()" class="bg-teal-500 text-white font-bold py-3 px-6 rounded-lg text-base sm:text-lg hover:bg-teal-600 transition-colors">
                            æ›ä¸‹ä¸€å€‹
                        </button>
                    </div>
                </div>
                
                <div id="t1-feedback-area" class="hidden text-center p-4 sm:p-6 bg-amber-50 rounded-lg space-y-3">
                    <p class="text-base sm:text-lg">ä½ å”¸çš„æ˜¯ï¼š<span id="t1-recognition-output" class="font-semibold text-amber-800"></span></p>
                    <div id="t1-star-rating" class="star-rating flex justify-center">
                        <span class="star">â˜…</span><span class="star">â˜…</span><span class="star">â˜…</span><span class="star">â˜…</span><span class="star">â˜…</span>
                    </div>
                    <p id="t1-encouragement" class="text-lg sm:text-xl font-bold text-amber-900"></p>
                    <p id="t1-tries-message" class="text-red-600 font-bold text-base sm:text-lg hidden"></p>
                </div>
                
                <div id="t1-history-area" class="hidden pt-6 border-t">
                    <div class="flex justify-between items-center mb-4 flex-wrap gap-2">
                        <div>
                            <h3 class="text-xl sm:text-2xl font-bold text-gray-800">ç·´ç¿’ç´€éŒ„</h3>
                            <p id="t1-progress-display" class="text-gray-600 font-semibold"></p>
                             <p id="t1-total-stars" class="text-amber-600 font-bold text-lg mt-1"></p>
                        </div>
                        <button onclick="exportPracticeHistory()" class="bg-blue-500 text-white font-bold py-2 px-4 rounded-lg text-sm sm:text-base hover:bg-blue-600 transition-colors self-start">åŒ¯å‡ºå–®å­—</button>
                    </div>
                    <div id="t1-history-list" class="space-y-2 max-h-60 overflow-y-auto bg-gray-50 p-4 rounded-lg">
                        <!-- Practiced words will be listed here -->
                    </div>
                    <div class="text-center mt-4">
                        <button id="t1-practice-mistakes-btn" onclick="practiceMistakes()" class="hidden bg-red-500 text-white font-bold py-3 px-6 rounded-lg text-base sm:text-lg hover:bg-red-600 transition-colors">ç·´ç¿’éŒ¯èª¤å–®å­—</button>
                    </div>
                </div>
            </div>
            
            <div id="message-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center p-4">
                <div class="bg-white p-8 rounded-lg shadow-xl text-center w-full max-w-md">
                    <p id="modal-message" class="text-lg font-medium text-gray-800"></p>
                    <button onclick="hideModal()" class="mt-6 bg-emerald-500 text-white font-bold py-2 px-6 rounded-lg text-lg hover:bg-emerald-600 transition-colors w-full sm:w-auto">
                        æˆ‘çŸ¥é“äº†
                    </button>
                </div>
            </div>
        </main>
    </div>

    <script>
        // --- å…¨åŸŸè®Šæ•¸å’Œè¨­å®š ---
        let recognition;
        let recognitionInProgress = false;

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        
        // --- å­¸ç”Ÿè³‡è¨Š ---
        let studentClass = '';
        let studentName = '';

        // --- åŠŸèƒ½ 1 è®Šæ•¸ ---
        let allWords = [];
        let wordGroups = [];
        let currentGroupIndex = -1;
        let practicedWords = [];
        let unpracticedWordList = [];
        let isReviewingMistakes = false;
        let t1_tryCount = 0;

        const highScorePhrases = [
            "å¤ªæ£’äº†ï¼ä½ çœŸæ˜¯å€‹èªè¨€å¤©æ‰ï¼", "ç™¼éŸ³çœŸæ¨™æº–ï¼Œç¹¼çºŒåŠ æ²¹ï¼", "å“‡ï¼èªªå¾—çœŸå¥½ï¼", "çµ¦ä½ ä¸€å€‹å¤§å¤§çš„è®šï¼"
        ];
        const lowScorePhrases = [
            "å¾ˆæ£’çš„å˜—è©¦ï¼å†è©¦ä¸€æ¬¡ï¼", "å·®ä¸€é»é»ï¼ŒåŠ æ²¹ï¼", "åˆ¥ç°å¿ƒï¼Œå¤šå”¸å¹¾æ¬¡å°±æœƒäº†ï¼", "å†åŠªåŠ›ä¸€ä¸‹ï¼Œä½ å¯ä»¥çš„ï¼"
        ];
        
        // --- åˆå§‹åŒ– ---
        document.addEventListener('DOMContentLoaded', () => {
            if (!SpeechRecognition) {
                showModal("æŠ±æ­‰ï¼Œæ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¾¨è­˜åŠŸèƒ½ï¼Œéƒ¨åˆ†æ ¸å¿ƒé«”é©—å°‡ç„¡æ³•ä½¿ç”¨ã€‚å»ºè­°ä½¿ç”¨é›»è…¦ç‰ˆ Chrome æˆ– Safari ç€è¦½å™¨ã€‚");
            }
            setupWordGroups();
        });

        // --- é€šç”¨å‡½å¼ ---
        function showModal(message) {
            document.getElementById('modal-message').textContent = message;
            document.getElementById('message-modal').classList.remove('hidden');
        }

        function hideModal() {
            document.getElementById('message-modal').classList.add('hidden');
        }

        /**
         * A modern and robust way to request microphone permission once.
         * @returns {Promise<boolean>} - True if permission is granted, false otherwise.
         */
        async function initMicrophonePermission() {
             if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                showModal("æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´éº¥å…‹é¢¨åŠŸèƒ½ã€‚");
                return false;
            }
            try {
                // This will trigger the browser prompt if permission is not yet granted.
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                // We don't need to use the stream, so we can stop it immediately.
                stream.getTracks().forEach(track => track.stop());
                return true; // Permission granted
            } catch (err) {
                console.error("Microphone permission error:", err);
                if (err.name === 'NotAllowedError' || err.name === 'PermissionDeniedError') {
                    showModal("æ‚¨å·²å°é–éº¥å…‹é¢¨æ¬Šé™ã€‚è«‹é»æ“Šç¶²å€åˆ—æ—çš„åœ–ç¤ºï¼Œä¸¦å…è¨±æ­¤ç¶²ç«™å­˜å–æ‚¨çš„éº¥å…‹é¢¨ï¼Œç„¶å¾Œé‡æ–°æ•´ç†é é¢ã€‚");
                } else {
                    showModal("ç„¡æ³•å–å¾—éº¥å…‹é¢¨æ¬Šé™ï¼ŒèªéŸ³åŠŸèƒ½å°‡ç„¡æ³•ä½¿ç”¨ã€‚");
                }
                return false; // Permission denied or error
            }
        }

        function speak(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                utterance.rate = 0.85;
                window.speechSynthesis.speak(utterance);
            } else {
                showModal("æŠ±æ­‰ï¼Œæ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³æœ—è®€åŠŸèƒ½ã€‚");
            }
        }

        function displayFeedback(stars) {
            const starContainer = document.getElementById('t1-star-rating');
            const encouragementEl = document.getElementById('t1-encouragement');
            const feedbackArea = document.getElementById('t1-feedback-area');
            
            Array.from(starContainer.children).forEach((star, index) => {
                star.classList.toggle('filled', index < stars);
            });
            
            if (stars >= 4) {
                encouragementEl.textContent = highScorePhrases[Math.floor(Math.random() * highScorePhrases.length)];
            } else {
                encouragementEl.textContent = lowScorePhrases[Math.floor(Math.random() * lowScorePhrases.length)];
            }
            
            feedbackArea.classList.remove('hidden');
        }
        
        function levenshteinDistance(a, b) {
            const matrix = Array(b.length + 1).fill(null).map(() => Array(a.length + 1).fill(null));
            for (let i = 0; i <= a.length; i += 1) matrix[0][i] = i;
            for (let j = 0; j <= b.length; j += 1) matrix[j][0] = j;
            for (let j = 1; j <= b.length; j += 1) {
                for (let i = 1; i <= a.length; i += 1) {
                    const indicator = a[i - 1] === b[j - 1] ? 0 : 1;
                    matrix[j][i] = Math.min(
                        matrix[j][i - 1] + 1,
                        matrix[j - 1][i] + 1,
                        matrix[j - 1][i - 1] + indicator,
                    );
                }
            }
            return matrix[b.length][a.length];
        }
        
        function handleRecognitionError(event) {
            let errorMsg = "";
            switch (event.error) {
                case 'no-speech': errorMsg = "è½ä¸åˆ°è²éŸ³å–”ï¼è«‹åœ¨æŒ‰ä¸‹éº¥å…‹é¢¨å¾Œï¼Œé è¿‘ä¸€é»ï¼Œç„¶å¾Œå†è©¦ä¸€æ¬¡ã€‚"; break;
                case 'aborted': break;
                case 'not-allowed':
                case 'service-not-allowed': errorMsg = "ç„¡æ³•ä½¿ç”¨éº¥å…‹é¢¨ã€‚è«‹é»æ“Šç¶²å€åˆ—æ—çš„åœ–ç¤ºï¼Œä¸¦å…è¨±æ­¤ç¶²ç«™å­˜å–æ‚¨çš„éº¥å…‹é¢¨ã€‚"; break;
                case 'network': errorMsg = "ç¶²è·¯éŒ¯èª¤å°è‡´èªéŸ³è¾¨è­˜å¤±æ•—ï¼Œè«‹æª¢æŸ¥æ‚¨çš„ç¶²è·¯é€£ç·šã€‚"; break;
                default: errorMsg = `èªéŸ³è¾¨è­˜ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤ (${event.error})ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚`; break;
            }
            if (errorMsg) showModal(errorMsg);
        }

        // --- å­¸ç”Ÿèˆ‡ç·´ç¿’æµç¨‹æ§åˆ¶ ---
        async function startPractice() {
            studentClass = document.getElementById('student-class-input').value.trim();
            studentName = document.getElementById('student-name-input').value.trim();

            if (!studentClass || !studentName) {
                showModal("è«‹å‹™å¿…è¼¸å…¥ç­ç´šå’Œå§“åå–”ï¼");
                return;
            }
            
            // Request permission here, only once.
            const permissionGranted = await initMicrophonePermission();
            if (permissionGranted) {
                document.getElementById('user-info-area').classList.add('hidden');
                document.getElementById('main-practice-container').classList.remove('hidden');
            }
        }

        function setupWordGroups() {
            const rawWordList = `"a","ä¸€å€‹"\n"about","å¤§ç´„;é—œæ–¼..."\n"actor","ç”·æ¼”å“¡"\n"actress","å¥³æ¼”å“¡"\n"after","åœ¨...ä¹‹å¾Œ"\n"afternoon","ä¸‹åˆ"\n"again","å†ä¸€æ¬¡ã€åˆä¸€æ¬¡"\n"airplane","é£›æ©Ÿ"\n"airport","æ©Ÿå ´"\n"all","å…¨éƒ¨çš„"\n"always","ç¸½æ˜¯ã€æ°¸é "\n"an","ä¸€å€‹"\n"and","å’Œ"\n"angry","ç”Ÿæ°£çš„"\n"animal","å‹•ç‰©"\n"answer","å›ç­”"\n"apple","è˜‹æœ"\n"April","å››æœˆ"\n"arm","æ‰‹è‡‚"\n"art","ç¾è¡“ã€è—è¡“"\n"ask","å•"\n"at","åœ¨..."\n"August","å…«æœˆ"\n"aunt","é˜¿å§¨ã€å§‘å§‘..."\n"away","é›¢é–‹"\n"baby","å¬°å…’"\n"back","å‘å¾Œã€å›åŸè™•"\n"back","èƒŒ"\n"bad","ä¸å¥½çš„ã€å£çš„"\n"bag","è¢‹å­"\n"ball","çƒ"\n"banana","é¦™è•‰"\n"bank","éŠ€è¡Œ"\n"baseball","æ£’çƒ"\n"basketball","ç±ƒçƒ"\n"bathroom","æµ´å®¤"\n"be","æ˜¯"\n"beach","æµ·ç˜"\n"bear","ç†Š"\n"beautiful","ç¾éº—çš„"\n"because","å› ç‚º"\n"bed","åºŠ"\n"bedroom","è‡¥æˆ¿"\n"bee","èœœèœ‚"\n"beef","ç‰›è‚‰"\n"before","åœ¨...ä¹‹å‰"\n"behind","åœ¨...å¾Œé¢"\n"bicycle","è…³è¸è»Š"\n"big","å¤§çš„"\n"bike","è…³è¸è»Š"\n"bird","é³¥"\n"birthday","ç”Ÿæ—¥"\n"bite","å’¬"\n"black","é»‘è‰²çš„"\n"blackboard","é»‘æ¿"\n"blue","è—è‰²çš„"\n"boat","èˆ¹"\n"book","æ›¸"\n"bookstore","æ›¸åº—"\n"bored","è¦ºå¾—ç„¡èŠçš„"\n"boring","ä»¤äººç„¡èŠçš„"\n"both","å…©å€‹éƒ½"\n"bottle","ç“¶å­"\n"box","ç®±å­"\n"boy","ç”·å­©"\n"bread","éºµåŒ…"\n"breakfast","æ—©é¤"\n"brother","å“¥å“¥ã€å¼Ÿå¼Ÿ"\n"brown","å’–å•¡è‰²çš„"\n"brush","åˆ·"\n"bus","å…¬è»Š"\n"bus stop","å…¬è»Šç«™"\n"busy","å¿™ç¢Œçš„"\n"but","ä½†æ˜¯"\n"butterfly","è´è¶"\n"buy","è²·"\n"by","åœ¨...æ—é‚Š"\n"bye","å†è¦‹"\n"cake","è›‹ç³•"\n"call","æ‰“é›»è©±"\n"can","ç½å­"\n"can","å¯ä»¥"\n"candy","ç³–æœ"\n"cap","æ£’çƒå¸½"\n"car","è»Šå­"\n"card","å¡ç‰‡"\n"cat","è²“"\n"cellphone","æ‰‹æ©Ÿ"\n"chair","æ¤…å­"\n"chicken","é›"\n"chicken","é›è‚‰"\n"Chinese","ä¸­æ–‡"\n"chocolate","å·§å…‹åŠ›"\n"chopsticks","ç­·å­"\n"Christmas","è–èª•ç¯€"\n"class","èª²;ç­ç´š"\n"classroom","æ•™å®¤"\n"clean","æ¸…ç†"\n"clean","ä¹¾æ·¨çš„"\n"climb","çˆ¬"\n"clock","æ™‚é˜"\n"close","é—œ"\n"clothes","è¡£æœ"\n"cloudy","å¤šé›²çš„"\n"coat","å¤–å¥—"\n"coffee","å’–å•¡"\n"coke","å¯æ¨‚"\n"cold","æ„Ÿå†’"\n"cold","å¯’å†·çš„"\n"color","é¡è‰²"\n"come","ä¾†"\n"computer","é›»è…¦"\n"cook","å»šå¸«"\n"cook","åšé£¯"\n"cookies","é¤…ä¹¾"\n"cool","æ¸…æ¶¼çš„"\n"cool","æ¶¼çˆ½çš„"\n"cousin","å ‚å…„å¼Ÿå§Šå¦¹"\n"cow","ä¹³ç‰›"\n"cry","å“­"\n"cup","æ¯å­"\n"cute","å¯æ„›çš„"\n"dad","çˆ¸çˆ¸"\n"daddy","çˆ¸çˆ¸"\n"dance","è·³èˆ"\n"daughter","å¥³å…’"\n"day","å¤©"\n"December","åäºŒæœˆ"\n"department store","ç™¾è²¨å…¬å¸"\n"desk","æ›¸æ¡Œ"\n"different","ä¸ä¸€æ¨£çš„"\n"dining room","é¤å»³"\n"dinner","æ™šé¤"\n"dirty","é«’çš„"\n"dish","ç›¤å­"\n"do","åš"\n"doctor","é†«ç”Ÿ"\n"dog","ç‹—"\n"doll","ç©å¶"\n"dollar","å…ƒ"\n"door","é–€"\n"Dragon Boat Festival","ç«¯åˆç¯€"\n"draw","ç•«"\n"dream","å¤¢"\n"dress","æ´‹è£"\n"drink","å–"\n"drive","é–‹è»Š"\n"driver","å¸æ©Ÿ"\n"drum","é¼“"\n"duck","é´¨å­"\n"duck","é´¨è‚‰"\n"dumpling","æ°´é¤ƒ"\n"ear","è€³æœµ"\n"early","æ—©çš„"\n"Easter","å¾©æ´»ç¯€"\n"easy","ç°¡å–®çš„"\n"eat","åƒ"\n"egg","è›‹"\n"eight","å…«"\n"eighteen","åå…«"\n"eighty","å…«å"\n"elephant","å¤§è±¡"\n"eleven","åä¸€"\n"email","é›»å­éƒµä»¶"\n"English","è‹±æ–‡"\n"enjoy","äº«å—"\n"eraser","æ©¡çš®æ“¦"\n"evening","å‚æ™š"\n"every","æ¯ä¸€å€‹"\n"excited","è¦ºå¾—èˆˆå¥®çš„"\n"exciting","ä»¤äººèˆˆå¥®çš„"\n"excuse me","ä¸å¥½æ„æ€"\n"eye","çœ¼ç›"\n"face","è‡‰"\n"fall","æ‰è½"\n"fall","ç§‹å¤©"\n"family","å®¶åº­ã€å®¶äºº"\n"fan","é›»æ‰‡"\n"farmer","è¾²å¤«"\n"fast","å¿«é€Ÿçš„"\n"father","çˆ¸çˆ¸"\n"favorite","æœ€å–œæ­¡çš„"\n"February","äºŒæœˆ"\n"feel","æ„Ÿè¦º"\n"feet","è…³(è¤‡æ•¸)"\n"fifteen","åäº”"\n"fifty","äº”å"\n"find","æ‰¾"\n"fine","å¾ˆå¥½çš„"\n"fire station","æ¶ˆé˜²ç«™"\n"first","ç¬¬ä¸€"\n"fish","é‡£é­š"\n"fish","é­šè‚‰"\n"fish","é­š"\n"five","äº”"\n"floor","åœ°æ¿"\n"flower","èŠ±"\n"fly","é£›"\n"food","é£Ÿç‰©"\n"foot","è…³"\n"football","è¶³çƒ"\n"for","çµ¦ã€ç‚ºäº†"\n"fork","å‰å­"\n"forty","å››å"\n"four","å››"\n"fourteen","åå››"\n"free","å…è²»çš„"\n"French fries","è–¯æ¢"\n"Friday","æ˜ŸæœŸäº”"\n"fridge","é›»å†°ç®±"\n"friend","æœ‹å‹"\n"frog","é’è›™"\n"from","å¾..."\n"fruit","æ°´æœ"\n"full","é£½çš„"\n"fun","æœ‰è¶£çš„"\n"fun","æ¨‚è¶£"\n"game","éŠæˆ²ã€æ¯”è³½"\n"garden","èŠ±åœ’"\n"get","å¾—åˆ°"\n"gift","ç¦®ç‰©"\n"girl","å¥³å­©"\n"give","çµ¦"\n"glass","ç»ç’ƒæ¯"\n"glasses","çœ¼é¡"\n"glue","è† æ°´"\n"go","å»"\n"good","å¥½çš„"\n"goodbye","å†è¦‹"\n"grandfather","çˆºçˆº"\n"grandma","å¥¶å¥¶"\n"grandmother","å¥¶å¥¶"\n"grandpa","çˆºçˆº"\n"grape","è‘¡è„"\n"gray","ç°è‰²çš„"\n"great","å¾ˆæ£’çš„"\n"green","ç¶ è‰²çš„"\n"grow","æˆé•·"\n"hair","é ­é«®"\n"Halloween","è¬è–ç¯€"\n"hamburger","æ¼¢å ¡"\n"hand","æ‰‹"\n"happy","é–‹å¿ƒçš„"\n"hard","å›°é›£çš„"\n"hat","å¸½å­"\n"have","æœ‰"\n"he","ä»–"\n"head","é ­"\n"headache","é ­ç—›"\n"heavy","é‡çš„"\n"hello","å“ˆå›‰"\n"help","å¹«åŠ©"\n"her","å¥¹çš„"\n"her","å¥¹"\n"here","é€™è£¡"\n"hi","å—¨"\n"high","é«˜çš„"\n"hike","å¥è¡Œ"\n"him","ä»–(å—è©)"\n"hippo","æ²³é¦¬"\n"his","ä»–çš„"\n"hit","æ‰“"\n"home","å®¶"\n"homework","å›å®¶ä½œæ¥­"\n"hope","å¸Œæœ›"\n"horse","é¦¬"\n"hospital","é†«é™¢"\n"hot","ç‡™çš„"\n"hot","ç†±çš„"\n"house","æˆ¿å­"\n"how","å¦‚ä½•"\n"hundred","ä¸€ç™¾"\n"hungry","é¤“çš„"\n"hurry","è¶•å¿«"\n"hurt","å—å‚·"\n"I","æˆ‘"\n"ice cream","å†°æ·‡æ·‹"\n"in","åœ¨...è£¡é¢"\n"in front of","åœ¨...å‰é¢"\n"inside","åœ¨...è£¡é¢"\n"interesting","æœ‰è¶£çš„"\n"it","å®ƒ"\n"its","å®ƒçš„"\n"jacket","å¤¾å…‹"\n"January","ä¸€æœˆ"\n"Japan","æ—¥æœ¬"\n"job","å·¥ä½œ"\n"juice","æœæ±"\n"July","ä¸ƒæœˆ"\n"jump","è·³"\n"June","å…­æœˆ"\n"key","é‘°åŒ™"\n"kid","å°å­©"\n"kitchen","å»šæˆ¿"\n"kite","é¢¨ç®"\n"knife","åˆ€å­"\n"know","çŸ¥é“"\n"koala","ç„¡å°¾ç†Š"\n"lake","æ¹–"\n"lamp","ç‡ˆ"\n"last","æœ€å¾Œçš„"\n"late","æ™šçš„"\n"laugh","ç¬‘"\n"lazy","æ‡¶æƒ°çš„"\n"left","å·¦é‚Š"\n"leg","è…¿"\n"lemon","æª¸æª¬"\n"let's","è®“æˆ‘å€‘..."\n"library","åœ–æ›¸é¤¨"\n"light","è¼•çš„"\n"like","å–œæ­¡"\n"lion","ç…å­"\n"listen","è½"\n"live","ä½"\n"living room","å®¢å»³"\n"long","é•·çš„"\n"look","çœ‹"\n"love","æ„›"\n"lunch","åˆé¤"\n"mad","ç”Ÿæ°£çš„"\n"mail","ä¿¡"\n"mailman","éƒµå·®"\n"make","åš"\n"man","ç”·äºº"\n"many","è¨±å¤š"\n"March","ä¸‰æœˆ"\n"marker","éº¥å…‹ç­†"\n"market","å¸‚å ´"\n"math","æ•¸å­¸"\n"May","äº”æœˆ"\n"maybe","ä¹Ÿè¨±"\n"me","æˆ‘(å—è©)"\n"meal","é¤"\n"meet","é‡è¦‹"\n"men","ç”·äºº(è¤‡æ•¸)"\n"mice","è€é¼ (è¤‡æ•¸)"\n"milk","ç‰›å¥¶"\n"miss","æƒ³å¿µ"\n"Miss","å°å§"\n"mom","åª½åª½"\n"mommy","åª½åª½"\n"Monday","æ˜ŸæœŸä¸€"\n"money","éŒ¢"\n"monkey","çŒ´å­"\n"month","æœˆ"\n"moon","æœˆäº®"\n"Moon Festival","ä¸­ç§‹ç¯€"\n"mop","æ‹–åœ°"\n"more","æ›´å¤š"\n"morning","æ—©ä¸Š"\n"mother","åª½åª½"\n"motorcycle","æ‘©æ‰˜è»Š"\n"mountain","å±±"\n"mouse","è€é¼ "\n"mouth","å˜´å·´"\n"movie","é›»å½±"\n"movie theater","é›»å½±é™¢"\n"Mr.","å…ˆç”Ÿ"\n"Mrs.","å¤ªå¤ª"\n"MRT","æ·é‹"\n"much","è¨±å¤š"\n"museum","åšç‰©é¤¨"\n"music","éŸ³æ¨‚"\n"my","æˆ‘çš„"\n"name","åå­—"\n"near","é è¿‘"\n"need","éœ€è¦"\n"never","ä¸æ›¾"\n"new","æ–°çš„"\n"next to","åœ¨...æ—é‚Š"\n"nice","å¥½çš„"\n"night","æ™šä¸Š"\n"nine","ä¹"\n"nineteen","åä¹"\n"ninety","ä¹å"\n"no","ä¸"\n"noodles","éºµ"\n"nose","é¼»å­"\n"not","ä¸"\n"nothing","æ²’æœ‰æ±è¥¿"\n"November","åä¸€æœˆ"\n"now","ç¾åœ¨"\n"number","æ•¸å­—"\n"nurse","è­·å£«"\n"o'clock","...é»é˜"\n"October","åæœˆ"\n"of","...çš„"\n"off","é›¢é–‹"\n"office","è¾¦å…¬å®¤"\n"OK","å¥½çš„"\n"old","è€çš„"\n"on","åœ¨...ä¸Šé¢"\n"one","ä¸€"\n"only","åªæœ‰"\n"open","é–‹"\n"orange","æ©˜å­"\n"orange","æ©˜è‰²çš„"\n"other","å…¶ä»–çš„"\n"our","æˆ‘å€‘çš„"\n"out","å‘å¤–"\n"outside","åœ¨...å¤–é¢"\n"over","åœ¨...ä¸Šæ–¹"\n"paint","ç•«ç•«"\n"pair","ä¸€é›™"\n"panda","å¤§è²“ç†Š"\n"pants","é•·è¤²"\n"paper","ç´™"\n"parent","çˆ¶æ¯"\n"park","å…¬åœ’"\n"party","æ´¾å°"\n"PE","é«”è‚²"\n"peach","æ¡ƒå­"\n"pen","ç­†"\n"pencil","é‰›ç­†"\n"people","äººå€‘"\n"person","äºº"\n"pet","å¯µç‰©"\n"photo","ç…§ç‰‡"\n"piano","é‹¼ç´"\n"pick up","æ’¿èµ·"\n"picture","åœ–ç‰‡"\n"pie","æ´¾"\n"pig","è±¬"\n"pink","ç²‰ç´…è‰²çš„"\n"pizza","æŠ«è–©"\n"plane","é£›æ©Ÿ"\n"play","ç©"\n"please","è«‹"\n"pocket","å£è¢‹"\n"police officer","è­¦å¯Ÿ"\n"police station","è­¦å¯Ÿå±€"\n"pork","è±¬è‚‰"\n"post office","éƒµå±€"\n"pretty","æ¼‚äº®çš„"\n"pumpkin","å—ç“œ"\n"purple","ç´«è‰²çš„"\n"put","æ”¾"\n"question","å•é¡Œ"\n"quiet","å®‰éœçš„"\n"rabbit","å…”å­"\n"rain","ä¸‹é›¨"\n"rain","é›¨æ°´"\n"rainbow","å½©è™¹"\n"rainy","ä¸‹é›¨çš„"\n"read","é–±è®€"\n"ready","æº–å‚™å¥½çš„"\n"really","çœŸæ­£åœ°"\n"red","ç´…è‰²çš„"\n"refrigerator","é›»å†°ç®±"\n"restaurant","é¤å»³"\n"restroom","æ´—æ‰‹é–“"\n"rice","ç±³é£¯"\n"ride","é¨"\n"right","å³é‚Š"\n"right","å°çš„"\n"river","æ²³æµ"\n"robot","æ©Ÿå™¨äºº"\n"ruler","å°º"\n"run","è·‘"\n"sad","å‚·å¿ƒçš„"\n"salad","æ²™æ‹‰"\n"sale","ç‰¹åƒ¹"\n"sandwich","ä¸‰æ˜æ²»"\n"Saturday","æ˜ŸæœŸå…­"\n"say","èªª"\n"school","å­¸æ ¡"\n"science","ç§‘å­¸"\n"scooter","è¼•å‹æ©Ÿè»Š"\n"sea","å¤§æµ·"\n"season","å­£ç¯€"\n"second","ç¬¬äºŒ"\n"see","çœ‹è¦‹"\n"September","ä¹æœˆ"\n"seven","ä¸ƒ"\n"seventeen","åä¸ƒ"\n"seventy","ä¸ƒå"\n"she","å¥¹"\n"sheep","ç¶¿ç¾Š"\n"shelf","æ¶å­"\n"ship","èˆ¹"\n"shirt","è¥¯è¡«"\n"shoes","é‹å­"\n"shop","å•†åº—"\n"short","çŸ­çš„"\n"short","çŸ®çš„"\n"shorts","çŸ­è¤²"\n"show","å±•ç¤º"\n"shower","æ·‹æµ´"\n"sick","ç”Ÿç—…çš„"\n"sing","å”±æ­Œ"\n"singer","æ­Œæ‰‹"\n"sister","å§Šå¦¹"\n"sit","å"\n"six","å…­"\n"sixteen","åå…­"\n"sixty","å…­å"\n"skirt","è£™å­"\n"sky","å¤©ç©º"\n"sleep","ç¡è¦º"\n"slow","æ…¢çš„"\n"small","å°çš„"\n"smart","è°æ˜çš„"\n"smell","è"\n"snake","è›‡"\n"snow","é›ª"\n"snow","ä¸‹é›ª"\n"so","æ‰€ä»¥"\n"soccer","è¶³çƒ"\n"socks","è¥ªå­"\n"sofa","æ²™ç™¼"\n"soldier","è»äºº"\n"some","ä¸€äº›"\n"sometimes","æœ‰æ™‚å€™"\n"son","å…’å­"\n"song","æ­Œæ›²"\n"sorry","å°ä¸èµ·"\n"soup","æ¹¯"\n"speak","èªª"\n"spell","æ‹¼å¯«"\n"spider","èœ˜è››"\n"spoon","æ¹¯åŒ™"\n"sport","é‹å‹•"\n"spring","æ˜¥å¤©"\n"stand","ç«™"\n"star","æ˜Ÿæ˜Ÿ"\n"start","é–‹å§‹"\n"station","è»Šç«™"\n"still","ä»ç„¶"\n"stop","åœ"\n"store","å•†åº—"\n"story","æ•…äº‹"\n"strawberry","è‰è“"\n"street","è¡—é“"\n"strong","å¼·å£¯çš„"\n"student","å­¸ç”Ÿ"\n"study","å­¸ç¿’"\n"summer","å¤å¤©"\n"sun","å¤ªé™½"\n"Sunday","æ˜ŸæœŸæ—¥"\n"sunny","æ™´æœ—çš„"\n"supermarket","è¶…ç´šå¸‚å ´"\n"sure","ç¢ºå®šçš„"\n"sweater","æ¯›è¡£"\n"sweep","æƒ"\n"sweet","ç”œçš„"\n"swim","æ¸¸æ³³"\n"table","æ¡Œå­"\n"Taiwan","è‡ºç£"\n"take","æ‹¿"\n"talk","èªªè©±"\n"tall","é«˜çš„"\n"taste","åšèµ·ä¾†"\n"taxi","è¨ˆç¨‹è»Š"\n"tea","èŒ¶"\n"teacher","è€å¸«"\n"teeth","ç‰™é½’(è¤‡æ•¸)"\n"telephone","é›»è©±"\n"television","é›»è¦–"\n"tell","å‘Šè¨´"\n"ten","å"\n"test","è€ƒè©¦"\n"than","æ¯”"\n"thank","æ„Ÿè¬"\n"that","é‚£å€‹"\n"the","é€™ã€é‚£"\n"their","ä»–å€‘çš„"\n"them","ä»–å€‘(å—è©)"\n"then","ç„¶å¾Œ"\n"there","é‚£è£¡"\n"these","é€™äº›"\n"they","ä»–å€‘"\n"thin","ç˜¦çš„"\n"thing","æ±è¥¿"\n"third","ç¬¬ä¸‰"\n"thirsty","å£æ¸´çš„"\n"thirteen","åä¸‰"\n"thirty","ä¸‰å"\n"this","é€™å€‹"\n"those","é‚£äº›"\n"three","ä¸‰"\n"Thursday","æ˜ŸæœŸå››"\n"ticket","ç¥¨"\n"tiger","è€è™"\n"time","æ™‚é–“"\n"tired","ç–²ç´¯çš„"\n"to","åˆ°..."\n"today","ä»Šå¤©"\n"together","ä¸€èµ·"\n"tomorrow","æ˜å¤©"\n"too","ä¹Ÿã€å¤ª"\n"tooth","ç‰™é½’"\n"toothache","ç‰™ç—›"\n"touch","è§¸ç¢°"\n"towel","æ¯›å·¾"\n"toy","ç©å…·"\n"train","ç«è»Š"\n"trash","åƒåœ¾"\n"tree","æ¨¹"\n"trip","æ—…è¡Œ"\n"truck","å¡è»Š"\n"try","å˜—è©¦"\n"T-shirt","Tæ¤"\n"Tuesday","æ˜ŸæœŸäºŒ"\n"turn","è½‰å½"\n"turtle","çƒé¾œ"\n"TV","é›»è¦–"\n"twelve","åäºŒ"\n"twenty","äºŒå"\n"two","äºŒ"\n"typhoon","é¢±é¢¨"\n"UK","è‹±åœ‹"\n"umbrella","å‚˜"\n"uncle","å”å”ã€èˆ…èˆ…..."\n"under","åœ¨...ä¸‹é¢"\n"up","å‘ä¸Š"\n"us","æˆ‘å€‘(å—è©)"\n"USA","ç¾åœ‹"\n"usually","é€šå¸¸"\n"vacation","å‡æœŸ"\n"very","éå¸¸"\n"wait","ç­‰å¾…"\n"waiter","ç”·æœå‹™ç”Ÿ"\n"waitress","å¥³æœå‹™ç”Ÿ"\n"wake","é†’ä¾†"\n"walk","èµ°è·¯"\n"wall","ç‰†å£"\n"want","æƒ³è¦"\n"warm","æº«æš–çš„"\n"wash","æ´—"\n"watch","çœ‹"\n"watch","æ‰‹éŒ¶"\n"water","æ°´"\n"watermelon","è¥¿ç“œ"\n"way","è·¯ã€æ–¹æ³•"\n"we","æˆ‘å€‘"\n"wear","ç©¿ã€æˆ´"\n"weather","å¤©æ°£"\n"Wednesday","æ˜ŸæœŸä¸‰"\n"week","æ˜ŸæœŸ"\n"welcome","æ­¡è¿"\n"well","å¥½çš„"\n"wet","æ¿•çš„"\n"whale","é¯¨é­š"\n"what","ä»€éº¼"\n"when","ä½•æ™‚"\n"where","åœ¨å“ªè£¡"\n"which","å“ªä¸€å€‹"\n"white","ç™½è‰²çš„"\n"who","èª°"\n"whose","èª°çš„"\n"why","ç‚ºä»€éº¼"\n"will","å°‡æœƒ"\n"win","è´"\n"wind","é¢¨"\n"window","çª—æˆ¶"\n"windy","é¢¨å¤§çš„"\n"winter","å†¬å¤©"\n"with","å’Œ...ä¸€èµ·"\n"woman","å¥³äºº"\n"women","å¥³äºº(è¤‡æ•¸)"\n"wonderful","å¾ˆæ£’çš„"\n"word","å­—"\n"work","å·¥ä½œ"\n"worker","å·¥ä½œè€…"\n"worry","æ“”å¿ƒ"\n"write","å¯«"\n"year","å¹´"\n"yellow","é»ƒè‰²çš„"\n"yes","æ˜¯"\n"yesterday","æ˜¨å¤©"\n"yo-yo","æºœæºœçƒ"\n"you","ä½ ã€ä½ å€‘"\n"young","å¹´è¼•çš„"\n"your","ä½ çš„ã€ä½ å€‘çš„"\n"yummy","å¥½åƒçš„"\n"zebra","æ–‘é¦¬"\n"zero","é›¶"\n"zoo","å‹•ç‰©åœ’"`;
            
            allWords = rawWordList.split('\n').map(line => {
                const parts = line.replace(/"/g, '').split(',');
                return { english: parts[0], chinese: parts[1] };
            }).filter(word => word.english && word.chinese && word.english.length > 1);

            const groupSize = 50;
            for (let i = 0; i < allWords.length; i += groupSize) {
                wordGroups.push(allWords.slice(i, i + groupSize));
            }

            const groupContainer = document.getElementById('t1-group-selection');
            groupContainer.innerHTML = '';
            wordGroups.forEach((group, index) => {
                const button = document.createElement('button');
                button.textContent = `Group ${index + 1}`;
                button.className = 'group-btn bg-gray-200 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-300';
                button.onclick = () => selectGroup(index);
                groupContainer.appendChild(button);
            });
        }
        
        function selectGroup(index) {
            currentGroupIndex = index;
            document.getElementById('t1-practice-area').classList.remove('hidden');
            
            const buttons = document.querySelectorAll('#t1-group-selection .group-btn');
            buttons.forEach((btn, i) => btn.classList.toggle('active', i === index));

            initializeWordPractice(index);
        }

        function initializeWordPractice(groupIndex) {
            unpracticedWordList = [...wordGroups[groupIndex].map(w => w.chinese)];
            practicedWords = [];
            isReviewingMistakes = false;
            
            document.getElementById('t1-result-area').classList.add('hidden');
            document.getElementById('t1-feedback-area').classList.add('hidden');
            document.getElementById('t1-input').value = '';
            
            updatePracticeHistory();
        }
        
        function updateProgressDisplay() {
            if (currentGroupIndex === -1) return;
            const practicedCount = practicedWords.length;
            const totalCount = wordGroups[currentGroupIndex].length;
            document.getElementById('t1-progress-display').textContent = `ç·´ç¿’é€²åº¦ï¼š${practicedCount} / ${totalCount}`;
        }

        function updateTotalStars() {
            const totalStars = practicedWords.reduce((sum, word) => sum + (word.stars || 0), 0);
            document.getElementById('t1-total-stars').textContent = `ç¸½æ˜Ÿæ˜Ÿæ•¸ï¼š${totalStars} â˜…`;
        }

        function updatePracticeHistory() {
            const historyArea = document.getElementById('t1-history-area');
            if (currentGroupIndex === -1 || practicedWords.length === 0) {
                historyArea.classList.add('hidden');
                return;
            }
            
            historyArea.classList.remove('hidden');
            const historyList = document.getElementById('t1-history-list');
            const practiceMistakesBtn = document.getElementById('t1-practice-mistakes-btn');
            
            historyList.innerHTML = '';
            [...practicedWords].reverse().forEach(word => {
                const item = document.createElement('div');
                item.className = 'grid grid-cols-3 items-center p-2 border-b gap-2';
                const chineseWordClass = word.isIncorrect ? 'text-red-500 font-bold' : 'text-gray-700';
                const starsDisplay = word.stars ? `<span class="text-amber-500 text-lg">${'â˜…'.repeat(word.stars)}</span>` : '';
                
                item.innerHTML = `<p class="${chineseWordClass}">${word.chinese}</p>
                                  <p class="font-semibold text-gray-900">${word.english}</p>
                                  <p class="text-right">${starsDisplay}</p>`;
                historyList.appendChild(item);
            });

            const hasMistakes = practicedWords.some(word => word.isIncorrect);
            practiceMistakesBtn.classList.toggle('hidden', !hasMistakes);
            
            updateProgressDisplay();
            updateTotalStars();
        }

        function exportPracticeHistory() {
            if (practicedWords.length === 0) {
                showModal("æ²’æœ‰ç·´ç¿’ç´€éŒ„å¯ä»¥åŒ¯å‡ºã€‚");
                return;
            }

            // çµ±è¨ˆæ˜Ÿæ˜Ÿ
            const starCounts = { 5: 0, 4: 0, 3: 0, 2: 0, 1: 0, 0: 0 };
            practicedWords.forEach(word => {
                starCounts[word.stars || 0]++;
            });

            let textContent = `è‹±æ–‡å–®å­—ç·´ç¿’å ±å‘Š\n`;
            textContent += `==================\n`;
            textContent += `ç­ç´šï¼š${studentClass}\n`;
            textContent += `å§“åï¼š${studentName}\n`;
            textContent += `ç·´ç¿’ç¾¤çµ„ï¼šGroup ${currentGroupIndex + 1}\n`;
            textContent += `==================\n\n`;
            
            textContent += `æ˜Ÿæ˜Ÿçµ±è¨ˆï¼š\n`;
            textContent += `- 5é¡†æ˜Ÿï¼š${starCounts[5]} é¡Œ\n`;
            textContent += `- 4é¡†æ˜Ÿï¼š${starCounts[4]} é¡Œ\n`;
            textContent += `- 3é¡†æ˜Ÿï¼š${starCounts[3]} é¡Œ\n\n`;

            textContent += `ç·´ç¿’è©³æƒ…ï¼š\n`;
            textContent += `==================\n`;
            practicedWords.forEach(word => {
                let status = `(${word.stars || 0}é¡†æ˜Ÿ)`;
                if (word.stars < 5) {
                    status += " - è«‹å¤šç·´ç¿’";
                }
                textContent += `${word.chinese}: ${word.english} ${status}\n`;
            });

            const blob = new Blob([textContent], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${studentClass}_${studentName}_å–®å­—å ±å‘Š_Group${currentGroupIndex + 1}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        async function getNextWord() {
            if (unpracticedWordList.length === 0) {
                if (isReviewingMistakes) {
                    showModal("éŒ¯èª¤çš„å–®å­—éƒ½ç·´ç¿’å®Œå›‰ï¼");
                    isReviewingMistakes = false;
                    unpracticedWordList = wordGroups[currentGroupIndex]
                        .filter(word => !practicedWords.some(p => p.chinese === word.chinese))
                        .map(w => w.chinese);
                } else {
                    showModal("å¤ªå²å®³äº†ï¼ä½ å·²ç¶“ç·´ç¿’å®Œé€™å€‹ç¾¤çµ„çš„æ‰€æœ‰å–®å­—ï¼");
                }
                return;
            }
            const randomIndex = Math.floor(Math.random() * unpracticedWordList.length);
            const randomWord = unpracticedWordList.splice(randomIndex, 1)[0];
            document.getElementById('t1-input').value = randomWord;
            await translateAndSpeak();
        }

        async function translateAndSpeak() {
            const chineseText = document.getElementById('t1-input').value.trim();
            if (!chineseText) { showModal("è«‹å…ˆè¼¸å…¥ä¸­æ–‡å–®å­—ï¼"); return; }
            
            const wordData = allWords.find(w => w.chinese === chineseText);
            if (!wordData) {
                showModal("é€™å€‹å–®å­—ä¸åœ¨ç›®å‰çš„é¡Œåº«ä¸­ï¼Œè«‹è©¦è©¦åˆ¥çš„å–®å­—ã€‚");
                return;
            }
            const englishText = wordData.english;

            document.getElementById('t1-chinese-output').textContent = chineseText;
            document.getElementById('t1-english-output').textContent = englishText.trim();
            document.getElementById('t1-result-area').classList.remove('hidden');
            document.getElementById('t1-feedback-area').classList.add('hidden');
            document.getElementById('t1-tries-message').classList.add('hidden');
            document.getElementById('t1-record-btn').disabled = false;
            t1_tryCount = 0;
            speak(englishText.trim());

            const existingWordIndex = practicedWords.findIndex(word => word.chinese === chineseText);
            if (existingWordIndex === -1) {
                practicedWords.push({ chinese: chineseText, english: englishText.trim(), isIncorrect: false, stars: 0 });
            }
            updatePracticeHistory();
        }

        function repeatAudio(elementId) {
            const text = document.getElementById(elementId).textContent;
            if (text) speak(text);
        }
        
        // This is a simplified function that assumes permission has been granted.
        function simpleStartRecognition(lang, onResultCallback, uiElements) {
             if (recognitionInProgress) return;
            if (!SpeechRecognition) {
                showModal("ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¾¨è­˜");
                return;
            }
            recognitionInProgress = true;
            // Update UI
            if (uiElements.recordBtn) {
                uiElements.recordBtn.textContent = "æ­£åœ¨è†è½...";
                uiElements.recordBtn.classList.add('bg-red-500');
            }
            if (uiElements.micButton) {
                uiElements.micButton.disabled = true;
                uiElements.micButton.classList.add('text-red-500');
            }
            
            recognition = new SpeechRecognition();
            recognition.lang = lang;
            recognition.onresult = (event) => onResultCallback(event.results[0][0].transcript);
            recognition.onerror = handleRecognitionError;
            recognition.onend = () => {
                recognitionInProgress = false;
                // Reset UI
                if (uiElements.recordBtn) {
                    uiElements.recordBtn.textContent = "ğŸ¤ æŒ‰ä½èªªè©±";
                    uiElements.recordBtn.classList.remove('bg-red-500');
                }
                if (uiElements.micButton) {
                    uiElements.micButton.disabled = false;
                    uiElements.micButton.classList.remove('text-red-500');
                }
            };
            recognition.start();
        }

        function startChineseRecognition() {
            const onResultCallback = (transcript) => {
                document.getElementById('t1-input').value = transcript;
            };
            const uiElements = { micButton: document.getElementById('t1-mic-btn') };
            simpleStartRecognition('zh-TW', onResultCallback, uiElements);
        }
        
        // This is the onmousedown handler
        function startEnglishRecognition() {
            if (t1_tryCount >= 3) return;
            const uiElements = { recordBtn: document.getElementById('t1-record-btn') };
            simpleStartRecognition('en-US', processRecognitionResult, uiElements);
        }

        function stopRecognition() {
            if (recognitionInProgress && recognition) {
                recognition.stop();
            }
        }
        
        // Helper for number word conversion
        const numberWordMap = {
            '80': 'eighty', '18': 'eighteen', '8': 'eight',
            '30': 'thirty', '13': 'thirteen', '3': 'three',
            '40': 'forty', '14': 'fourteen', '4': 'four',
            '50': 'fifty', '15': 'fifteen', '5': 'five',
            '60': 'sixty', '16': 'sixteen', '6': 'six',
            '70': 'seventy', '17': 'seventeen', '7': 'seven',
            '90': 'ninety', '19': 'nineteen', '9': 'nine',
            '10': 'ten', '11': 'eleven', '12': 'twelve', '20': 'twenty',
            '1': 'one', '2': 'two', '100': 'hundred', '0': 'zero'
        };

        function processRecognitionResult(transcript) {
            t1_tryCount++;
            const targetText = document.getElementById('t1-english-output').textContent.toLowerCase().trim();
            document.getElementById('t1-recognition-output').textContent = transcript;
            let normalizedTranscript = transcript.toLowerCase().trim().replace(/[.,!?]/g, '');
            
            // NEW: Convert recognized digits to words if they match our map
            if (numberWordMap[normalizedTranscript]) {
                normalizedTranscript = numberWordMap[normalizedTranscript];
            }
            
            const distance = levenshteinDistance(normalizedTranscript, targetText);
            const similarity = 1 - (distance / Math.max(normalizedTranscript.length, targetText.length));

            let stars = 0;
            let isCorrect = false;

            if (similarity >= 0.9) {
                stars = 5;
                isCorrect = true;
            } else if (similarity >= 0.6) {
                stars = 4;
                isCorrect = true;
            } else {
                stars = 3;
                isCorrect = false;
            }

            displayFeedback(stars);
            
            const currentWordIndex = practicedWords.findIndex(w => w.chinese === document.getElementById('t1-chinese-output').textContent);
            if (currentWordIndex > -1) {
                practicedWords[currentWordIndex].isIncorrect = !isCorrect;
                if (stars > (practicedWords[currentWordIndex].stars || 0)) {
                    practicedWords[currentWordIndex].stars = stars;
                }
                if(isCorrect) {
                    practicedWords[currentWordIndex].isIncorrect = false;
                }
            }
            
            updatePracticeHistory();
            
            const recordBtn = document.getElementById('t1-record-btn');
            const triesMessage = document.getElementById('t1-tries-message');

            if (isCorrect) {
                triesMessage.classList.add('hidden');
                recordBtn.disabled = true;
            } else {
                if (t1_tryCount >= 3) {
                    triesMessage.textContent = 'æ©Ÿæœƒç”¨å®Œäº†ï¼Œè«‹æŒ‰ã€Œæ›ä¸‹ä¸€å€‹ã€ç·´ç¿’æ–°å–®å­—å§ï¼';
                    triesMessage.classList.remove('hidden');
                    recordBtn.disabled = true;
                }
            }
        }

        function practiceMistakes() {
            const mistakes = practicedWords.filter(word => word.isIncorrect);
            if (mistakes.length === 0) {
                showModal("å¤ªæ£’äº†ï¼Œé€™å€‹ç¾¤çµ„æ²’æœ‰éŒ¯èª¤çš„å–®å­—éœ€è¦ç·´ç¿’ï¼");
                return;
            }
            isReviewingMistakes = true;
            unpracticedWordList = mistakes.map(word => word.chinese);
            
            practicedWords = practicedWords.filter(word => !word.isIncorrect);
            
            updatePracticeHistory();
            showModal(`æº–å‚™ç·´ç¿’ ${mistakes.length} å€‹éŒ¯èª¤çš„å–®å­—ï¼`);
            getNextWord();
        }
    </script>
</body>
</html>
